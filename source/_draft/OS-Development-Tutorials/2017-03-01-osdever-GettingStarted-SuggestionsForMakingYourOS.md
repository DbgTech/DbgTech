---
title: 《系统开发》之编写操作系统建议
date: 2017-03-01 21:33:32
tags:
- 操作系统
- 翻译
categories:
- 系统
- 翻译
---

原文地址：[http://www.osdever.net/tutorials/view/suggestions-for-making-your-os](http://www.osdever.net/tutorials/view/suggestions-for-making-your-os)

### 1.使用链接器脚本 ###

在编写我的内核时遇到了很多问题，直到我使用了链接器脚本。基本上来讲，链接器脚本认为你的内核按照正确的顺序进行链接（text，data，bss）。如下是一个链接器脚本，它表示将内核加载到0xFF80000（John Fine的bootf2.zip引导扇区是这样做的）。注意这个链接脚本是为LD链接器准备的：

kernel.lnk
```ASM
OUTPUT_FORMAT("binary")
ENTRY(start)
SECTIONS
{
		.text  0xFF800000 : {
			*(.text)
		}
		.data  : {
			*(.data)
		}
		.bss  : {
			*(.bss)
		}
}
```

然后就可以按照如下的形式链接了：

```
ld -T kernel.lnk  kernel.o
```
<!-- more -->
### 2.用ASM创建一个“样本文件”来执行内核 ###

如果你的内核用C编写，我建议你从ASM文件（如下所示）来运行你的内核主函数（假设是保护模式）：

kernel_asm.asm
```ASM
[bits 32] ; hey, we're in PMode

[global start]
	[extern _kernel_main] ; always add a "_" in front of a C function to call it
    
	start:
	call _kernel_main
	jmp $ ; halt
```

kernel_c.c
```C
kernel_main()
{
		k_init();
		k_sayhello();
		...
};
```

然后将两个文件链接到一起。

### 3.使用模拟器，这样就不需要不断重启机器 ###
  
反反复复重启机器非常慢，减少计算机的寿命。并且计算机也无法告诉你代码中发生了什么错误，是3rd异常或是通用保护错误，或是其他什么问题。模拟器，比如Bochs就可以解决这些问题。
  
### 4.备份代码 ###
  
无论何时对代码做了重大的或较小的修改，请备份你的代码。这样做有这么几个目的：首先，如果你毁掉了大部分代码，你依然可以回滚到之前的版本。其次，如果有一些人说你偷了他们的源码，并做了修改时，你可以用这些备份代码来证明是你自己写的系统。当然了，你需要将你的代码备份到不同的机器上，或是不同的ZIP包，再或者是CD中，以防止硬盘损坏而造成的代码丢失。

### 5.当对一个重大bug或不理解一些东西时，要请求帮助 ###
  
这也是为什么有OS开发论坛存在。Mega-tokyo.com OS开发论坛是一个非常棒的提问的地方。你们也可以给我写邮件，提出问题。由于我每天有大量邮件需要处理，并且我的日程也很忙，所以我可能不会马上回答它，但一定会回复你的。记住，没有愚蠢的问题，只有不提问的人。

### 6.将注意力放到内核上，而不是奇特的界面上 ###
  
很多人都想拥有绚丽的界面。要等到你的内核成熟或完善了再添加界面。为什么？因为界面编程（特别是SVGA）比内核编程困难很多。

### 7.理解你所编写代码 ###
  
这个建议似乎是非常明显，但是所有的OS开发者都不遵循。你必须理解你所写的代码。并且保证没有你不理解的烦人代码。如果你不理解你所写的代码，那么最终你会遇到难解的bug，这些bug将花费你大量时间去解决。如果你了解代码如何工作，并且理解了，那么修改bug将是轻而易举的事情。

### 8.玩得高兴 ###
  
像其他任何种类的编程一样，如果你喜欢它，就应该成为OS开发者。就是如此简单。不要期望着写这个东西某一天能给你带来金钱。如果你不热爱这项工作，并且也不是为了兴趣而做，那么你会以一个垃圾OS而终结。事实上，好的OS开发者喜爱OS开发，并且就像热爱它一样感到非常有意思。

By Andy @ 2017/03/01 21:30:17 